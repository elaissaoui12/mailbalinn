"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["2102"],{84075:function(e,a,t){t.d(a,{WH:()=>u,hI:()=>i,iE:()=>c,mD:()=>o,sS:()=>n,uz:()=>v,vi:()=>m,yG:()=>p,yL:()=>d});var l=t(76882),s=t(34541);let{t:r}=l.Z.global,i=e=>s.e.get("/contact/group/list",{params:e}),u=()=>s.e.get("/contact/group/all"),d=e=>s.e.get("/contact/group/info",{params:e}),n=e=>s.e.post("/contact/group/create",e,{fetchOptions:{loading:r("contacts.group.loading.createGroup"),successMessage:!0}}),o=e=>s.e.post("/contact/group/update",e,{fetchOptions:{loading:r("contacts.group.loading.updateGroup"),successMessage:!0}}),c=e=>s.e.post("/contact/group/delete",e,{fetchOptions:{loading:r("contacts.group.loading.deleteGroup"),successMessage:!0}}),m=e=>s.e.post("/contact/group/contact_count",e),p=e=>s.e.post("/contact/group/export",e,{fetchOptions:{loading:r("contacts.group.loading.exportGroup"),successMessage:!0}}),v=e=>s.e.post("/contact/group/update",e,{fetchOptions:{loading:r("contacts.group.loading.saveSettings"),successMessage:!0}})},55855:function(e,a,t){t.d(a,{Gk:()=>u,Q5:()=>m,Xr:()=>c,ZS:()=>i,_5:()=>o,gI:()=>n,jC:()=>p,ke:()=>v,mQ:()=>d,oS:()=>k});var l=t(76882),s=t(34541);let{t:r}=l.Z.global;function i(e){return s.e.get("/batch_mail/task/list",{params:e})}function u(e){return s.e.get("/batch_mail/task/stat_chart",{params:e})}function d(e){return s.e.get("/batch_mail/task/find",{params:e})}function n(e){return s.e.post("/batch_mail/task/create",e,{fetchOptions:{loading:r("market.task.loading.creating"),successMessage:!0}})}function o(e){return s.e.post("/batch_mail/task/delete",e,{fetchOptions:{loading:r("market.task.loading.deleting"),successMessage:!0}})}function c(e){return s.e.post("/batch_mail/task/pause",e,{fetchOptions:{loading:r("market.task.loading.pausing"),successMessage:!0}})}function m(e){return s.e.post("/batch_mail/task/resume",e,{fetchOptions:{loading:r("market.task.loading.resuming"),successMessage:!0}})}function p(e){return s.e.post("/batch_mail/task/send_test",e,{fetchOptions:{loading:r("market.task.loading.sendingTest"),successMessage:!0}})}function v(e){return s.e.get("/batch_mail/tracking/mail_provider",{params:e})}function k(e){return s.e.get("/batch_mail/tracking/logs",{params:e})}},36289:function(e,a,t){t.r(a),t.d(a,{default:()=>eo});var l=t(53472),s=t(46244),r=t(17977),i=t(57869),u=t(29283),d=t(16715),n=t(2352),o=t(29875),c=t(15496),m=t(73084),p=t(6455),v=t(66236),k=t(70958),_=t(58786),f=t(31708),b=t(94821),g=t(68271),w=t(55855),h=t(19664),U=t(8490),S=t(51169),W=t(84075),y=t(3179),x=t(46471),j=t(98003),Z=t(52495);let $={class:"pt-12px"},z={class:"flex-1"},q={class:"mt-8px text-12px text-desc"},C=`email,attributes
example1@example.com,"{""age"": ""13"", ""Gender"": ""XXX""}"
example2@example.com,"{""age"": ""45"", ""city"": ""XXX""}"
`,R=(0,_.aZ)({__name:"CreateGroup",setup(e){let{t:a}=(0,Z.QT)(),t=(0,_.AE)("formRef"),l=(0,_.qj)({create_type:2,name:"",file_data:"",file_type:"",description:"",status:1}),r={name:{required:!0,message:a("market.task.createGroup.validation.groupNameRequired"),trigger:["blur","input"]}},i=[{label:"Confirmed",value:1},{label:"Unconfirmed",value:0}],u=e=>{let a=new FileReader;a.onload=a=>{var t;l.file_type=e.name.substring(e.name.lastIndexOf(".")+1),l.file_data=null==(t=a.target)?void 0:t.result},e.file&&a.readAsText(e.file)},d=async()=>{await (0,j.Sv)({file_path:"./template/example_recipients.csv"})},n=async()=>{var e;if(await (null==(e=t.value)?void 0:e.validate()),(0,x.Z)(l.file_data))return g.v0.error(a("contacts.subscribers.import.validation.fileRequired")),Promise.reject()},[o,v]=(0,S.d)({onChangeState:e=>{e&&(l.name="",l.file_data="",l.file_type="")},onConfirm:async()=>{await n(),await (0,W.sS)((0,_.IU)(l));let e=v.getState();null==e||e.refresh()}});return(e,n)=>{let v=m.Z,k=p.ZP,f=U.Z,b=y.Z,g=c.ZP,w=s.Z;return(0,_.wg)(),(0,_.j4)((0,_.SU)(o),{title:(0,_.SU)(a)("market.task.createGroup.title"),width:"500"},{default:(0,_.w5)(()=>[(0,_._)("div",$,[(0,_.Wm)(w,{ref_key:"formRef",ref:t,model:(0,_.SU)(l),rules:r},{default:(0,_.w5)(()=>[(0,_.Wm)(k,{label:(0,_.SU)(a)("market.task.createGroup.groupName"),path:"name"},{default:(0,_.w5)(()=>[(0,_.Wm)(v,{value:(0,_.SU)(l).name,"onUpdate:value":n[0]||(n[0]=e=>(0,_.SU)(l).name=e),placeholder:(0,_.SU)(a)("market.task.createGroup.groupNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),(0,_.Wm)(k,{label:"Status"},{default:(0,_.w5)(()=>[(0,_.Wm)(f,{value:(0,_.SU)(l).status,"onUpdate:value":n[1]||(n[1]=e=>(0,_.SU)(l).status=e),options:i},null,8,["value"])]),_:1}),(0,_.Wm)(k,{label:(0,_.SU)(a)("market.task.createGroup.email"),path:"file_data"},{default:(0,_.w5)(()=>[(0,_._)("div",z,[(0,_.Wm)(b,{"is-upload":!1,accept:["csv"],onChange:u}),(0,_._)("div",q,[(0,_.Uk)((0,_.zw)(e.$t("contacts.subscribers.import.fileTypeHint"))+" ",1),(0,_.Wm)(g,{text:"",type:"primary",onClick:d},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("common.actions.download")),1)]),_:1})])])]),_:1},8,["label"]),(0,_.Wm)(k,{label:e.$t("contacts.subscribers.import.exampleCsvLabel")},{default:(0,_.w5)(()=>[(0,_._)("pre",{class:"csv-example"},(0,_.zw)(C))]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var G=t(41748);let P=(0,G.default)(R,[["__scopeId","data-v-49081638"]]),T={class:"flex-1"},E={class:"flex items-center"},H={class:"flex-1"},M={class:"ml-12px"},O=(0,_.aZ)({__name:"GroupSelect",props:{value:{default:()=>[]},valueModifiers:{},label:{default:()=>[]},labelModifiers:{}},emits:["update:value","update:label"],setup(e){let a=(0,_.tT)(e,"value"),t=(0,_.tT)(e,"label"),l=(0,_.iH)(!1),s=(0,_.iH)([]),r=(0,_.iH)(0),[i,u]=(0,S.d)({component:P,state:{refresh:()=>{o()}}}),d=()=>{u.open()},n=async e=>{if(t.value=e.map(e=>{let a=s.value.find(a=>a.value===e);return`${(null==a?void 0:a.label)||""}`}),0===e.length){r.value=0;return}let a=await (0,W.vi)({group_ids:e});(0,g.Kn)(a)&&(r.value=a.total)},o=async()=>{try{l.value=!0;let e=await (0,W.WH)();(0,g.Kn)(e)&&(s.value=e.list.map(e=>({label:e.name,value:e.id})))}finally{l.value=!1}};return o(),(e,t)=>{let u=U.Z,o=c.ZP,m=(0,_.up)("i18n-t");return(0,_.wg)(),(0,_.iD)("div",T,[(0,_._)("div",E,[(0,_._)("div",H,[(0,_.Wm)(u,{value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),n],options:(0,_.SU)(s),multiple:!0,filterable:!0,"max-tag-count":"responsive",loading:(0,_.SU)(l),placeholder:e.$t("market.task.edit.recipientsPlaceholder")},null,8,["value","options","loading","placeholder"])]),(0,_._)("div",M,[(0,_.Wm)(o,{text:"",type:"primary",onClick:d},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("common.actions.create")),1)]),_:1})])]),(0,_.Wm)(m,{class:"mt-8px",tag:"div",scope:"global",keypath:"market.task.edit.recipientsCount"},{count:(0,_.w5)(()=>[(0,_._)("b",null,(0,_.zw)((0,_.SU)(r)),1)]),_:1}),(0,_.Wm)((0,_.SU)(i))])}}});var N=t(28444),I=t(65965);let X={class:"task-edit-container"},D={class:"flex flex-col flex-1 p-24px overflow-auto"},A={class:"flex-1"},Q={class:"ml-12px text-desc"},L={class:"w-60px"},K={class:"flex-1 mr-10px"},F={class:"task-preview"},B={class:"preview-header"},J={class:"preview-header-item"},V={class:"preview-label"},Y={class:"preview-value"},ee={class:"preview-header-item"},ea={class:"preview-label"},et={class:"preview-value"},el={class:"preview-header-item"},es={class:"preview-label"},er={class:"preview-value"},ei={class:"preview-content"},eu={key:1,class:"empty-preview"},ed={class:"action-buttons"},en=(0,_.aZ)({__name:"edit",setup(e){let{t:a}=(0,Z.QT)(),t=(0,f.s6)(),U=(0,I.tv)(),S=(0,I.yj)(),W=(0,_.AE)("formRef"),y=(0,_.AE)("formContentRef"),{height:x}=(0,b.rBN)(y),j=(0,_.qj)({addresser:null,full_name:"",subject:"",group_ids:[],template_id:null,is_record:1,unsubscribe:1,warmup:0,threads:0,start_time:null,remark:""}),$={full_name:{trigger:["blur","input"],validator:()=>""!==j.full_name||Error(a("market.task.edit.validation.displayNameRequired"))},subject:{trigger:["blur","input"],validator:()=>""!==j.subject||Error(a("market.task.edit.validation.subjectRequired"))},group_ids:{trigger:"change",validator:()=>0!==j.group_ids.length||Error(a("market.task.edit.validation.recipientsRequired"))},template_id:{trigger:"change",validator:()=>null!==j.template_id||Error(a("market.task.edit.validation.templateRequired"))},start_time:{validator:()=>1!==C.value||null!==j.start_time||Error(a("market.task.edit.validation.sendTimeRequired"))}},z=(0,_.iH)([]),q=(0,_.iH)(0),C=(0,_.iH)(0),R=(0,_.iH)(""),G=(0,_.iH)(""),P=()=>{U.push("/template")},T=e=>{0===e?j.threads=0:j.threads=5},E=()=>{0===C.value&&(j.start_time=null)},H=async()=>R.value?j.subject?j.template_id?void await (0,w.jC)({addresser:j.addresser||"",subject:j.subject,recipient:R.value,template_id:j.template_id||0}):void g.v0.error(a("market.task.edit.validation.templateRequired")):void g.v0.error(a("market.task.edit.validation.subjectRequired")):void g.v0.error(a("market.task.edit.validation.testEmailRequired")),M=()=>{j.subject||j.group_ids.length>0?(0,g.iG)({title:a("market.task.edit.discard.title"),content:a("market.task.edit.discard.content"),onConfirm:()=>{U.go(-1)}}):U.go(-1)},en=()=>{let e=j.start_time;return(0===C.value||null===e)&&(e=Date.now()),{track_open:1,track_click:1,addresser:j.addresser||"",full_name:j.full_name,subject:j.subject,group_ids:j.group_ids,template_id:j.template_id||0,is_record:j.is_record,unsubscribe:j.unsubscribe,warmup:j.warmup,threads:j.threads,start_time:e/1e3,remark:j.remark}},eo=async()=>{var e;await (null==(e=W.value)?void 0:e.validate()),await (0,w.gI)(en()),U.push("/market/task")};function ec(e){if(S.query.chat_id){let a=e.find(e=>e.chat_id==S.query.chat_id);a&&(j.template_id=a.id,j.subject=t.temp_subject,G.value=a.html_content)}}return(async()=>{let{task_id:e}=S.query;if(!e)return;let a=await (0,w.mQ)({id:Number(e)});(0,g.Kn)(a)&&(j.addresser=a.addresser,j.full_name=a.full_name,j.subject=a.subject,j.group_ids=a.etypes.split(",").map(e=>Number(e)),j.template_id=a.template_id,j.is_record=a.is_record,j.unsubscribe=a.unsubscribe,j.threads=a.threads,q.value=+(0!==a.threads),j.remark=a.remark)})(),(e,t)=>{let f=(0,_.up)("router-link"),b=k.Z,g=v.ZP,w=p.ZP,U=m.Z,S=c.ZP,Z=o.Z,I=n.Z,en=d.Z,em=u.Z,ep=i.ZP,ev=r.Z,ek=s.Z,e_=l.Z;return(0,_.wg)(),(0,_.iD)("div",X,[(0,_._)("div",D,[(0,_.Wm)(g,{class:"mb-20px"},{default:(0,_.w5)(()=>[(0,_.Wm)(b,null,{default:(0,_.w5)(()=>[(0,_.Wm)(f,{to:"/market/task"},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("market.task.title")),1)]),_:1})]),_:1}),(0,_.Wm)(b,null,{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("market.task.edit.addTitle")),1)]),_:1})]),_:1}),(0,_._)("div",{class:"task-edit-box",style:(0,_.j5)({minHeight:(0,_.SU)(x)+"px"})},[(0,_.Wm)(ek,{ref_key:"formRef",ref:W,class:"task-edit-form",model:(0,_.SU)(j),rules:$},{default:(0,_.w5)(()=>[(0,_._)("div",{ref_key:"formContentRef",ref:y},[(0,_.Wm)(ep,{class:"mb-24px"},{default:(0,_.w5)(()=>[(0,_.Wm)(w,{label:e.$t("market.task.edit.from")},{default:(0,_.w5)(()=>[(0,_.Wm)(h.Z,{value:(0,_.SU)(j).addresser,"onUpdate:value":t[0]||(t[0]=e=>(0,_.SU)(j).addresser=e),name:(0,_.SU)(j).full_name,"onUpdate:name":t[1]||(t[1]=e=>(0,_.SU)(j).full_name=e)},null,8,["value","name"])]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.displayName"),path:"full_name"},{default:(0,_.w5)(()=>[(0,_.Wm)(U,{value:(0,_.SU)(j).full_name,"onUpdate:value":t[2]||(t[2]=e=>(0,_.SU)(j).full_name=e),placeholder:e.$t("market.task.edit.displayNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.subject"),path:"subject"},{default:(0,_.w5)(()=>[(0,_.Wm)(U,{value:(0,_.SU)(j).subject,"onUpdate:value":t[3]||(t[3]=e=>(0,_.SU)(j).subject=e),placeholder:e.$t("market.task.edit.subjectPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.recipients"),type:"group_ids"},{default:(0,_.w5)(()=>[(0,_.Wm)(O,{value:(0,_.SU)(j).group_ids,"onUpdate:value":t[4]||(t[4]=e=>(0,_.SU)(j).group_ids=e),label:(0,_.SU)(z),"onUpdate:label":t[5]||(t[5]=e=>(0,_.dq)(z)?z.value=e:null)},null,8,["value","label"])]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.template"),path:"template_id"},{default:(0,_.w5)(()=>[(0,_._)("div",A,[(0,_.Wm)(N.Z,{value:(0,_.SU)(j).template_id,"onUpdate:value":t[6]||(t[6]=e=>(0,_.SU)(j).template_id=e),content:(0,_.SU)(G),"onUpdate:content":t[7]||(t[7]=e=>(0,_.dq)(G)?G.value=e:null),onListReady:ec},null,8,["value","content"])]),(0,_.Wm)(S,{text:"",type:"primary",class:"ml-12px",onClick:P},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)((0,_.SU)(a)("common.actions.create")),1)]),_:1})]),_:1},8,["label"]),(0,_.kq)("",!0),(0,_.Wm)(w,{label:(0,_.SU)(a)("market.task.edit.ipWarmup")},{default:(0,_.w5)(()=>[(0,_.Wm)(Z,{value:(0,_.SU)(j).warmup,"onUpdate:value":t[9]||(t[9]=e=>(0,_.SU)(j).warmup=e),"checked-value":1,"unchecked-value":0},null,8,["value"]),(0,_._)("span",Q,(0,_.zw)((0,_.SU)(a)("market.task.edit.ipWarmupTip")),1)]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.unsubscribeLink")},{default:(0,_.w5)(()=>[(0,_.Wm)(Z,{value:(0,_.SU)(j).unsubscribe,"onUpdate:value":t[10]||(t[10]=e=>(0,_.SU)(j).unsubscribe=e),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.threads"),"show-feedback":!1},{default:(0,_.w5)(()=>[(0,_.Wm)(en,{value:(0,_.SU)(q),"onUpdate:value":[t[11]||(t[11]=e=>(0,_.dq)(q)?q.value=e:null),T]},{default:(0,_.w5)(()=>[(0,_.Wm)(I,{value:0},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("market.task.edit.threadsAuto")),1)]),_:1}),(0,_.Wm)(I,{value:1},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("market.task.edit.threadsCustom")),1)]),_:1})]),_:1},8,["value"]),(0,_.wy)((0,_._)("div",L,[(0,_.Wm)(em,{value:(0,_.SU)(j).threads,"onUpdate:value":t[12]||(t[12]=e=>(0,_.SU)(j).threads=e),min:1,max:100,"show-button":!1},null,8,["value"])],512),[[_.F8,1===(0,_.SU)(q)]])]),_:1},8,["label"])]),_:1}),(0,_.Wm)(ep,null,{default:(0,_.w5)(()=>[(0,_.Wm)(w,{label:(0,_.SU)(a)("market.task.edit.sendTime"),path:"start_time"},{default:(0,_.w5)(()=>[(0,_.Wm)(en,{value:(0,_.SU)(C),"onUpdate:value":[t[14]||(t[14]=e=>(0,_.dq)(C)?C.value=e:null),E],class:"flex items-center"},{default:(0,_.w5)(()=>[(0,_.Wm)(I,{value:0},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)((0,_.SU)(a)("market.task.edit.sendTimeNow")),1)]),_:1}),(0,_.Wm)(I,{class:"items-center",value:1}),(0,_.Wm)(ev,{value:(0,_.SU)(j).start_time,"onUpdate:value":t[13]||(t[13]=e=>(0,_.SU)(j).start_time=e),class:"ml-8px",type:"datetime",disabled:0===(0,_.SU)(C)},null,8,["value","disabled"])]),_:1},8,["value"])]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.remark")},{default:(0,_.w5)(()=>[(0,_.Wm)(U,{value:(0,_.SU)(j).remark,"onUpdate:value":t[15]||(t[15]=e=>(0,_.SU)(j).remark=e),placeholder:e.$t("market.task.edit.remarkPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),(0,_.Wm)(w,{label:e.$t("market.task.edit.testEmail"),"show-feedback":!1},{default:(0,_.w5)(()=>[(0,_._)("div",K,[(0,_.Wm)(U,{value:(0,_.SU)(R),"onUpdate:value":t[16]||(t[16]=e=>(0,_.dq)(R)?R.value=e:null),placeholder:e.$t("market.task.edit.testEmailPlaceholder")},null,8,["value","placeholder"])]),(0,_.Wm)(S,{onClick:H},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("market.task.edit.sendTest")),1)]),_:1})]),_:1},8,["label"])]),_:1})],512)]),_:1},8,["model"]),(0,_._)("div",F,[(0,_.Wm)(ep,{class:"h-full","content-style":{display:"flex",flexDirection:"column",height:"100%"}},{default:(0,_.w5)(()=>[(0,_._)("div",B,[(0,_._)("div",J,[(0,_._)("div",V,(0,_.zw)((0,_.SU)(a)("market.task.edit.from"))+":",1),(0,_._)("div",Y,(0,_.zw)((0,_.SU)(j).addresser),1)]),(0,_._)("div",ee,[(0,_._)("div",ea,(0,_.zw)((0,_.SU)(a)("market.task.edit.to"))+":",1),(0,_._)("div",et,(0,_.zw)((0,_.SU)(z).length>0?(0,_.SU)(z).join(", "):"--"),1)]),(0,_._)("div",el,[(0,_._)("div",es,(0,_.zw)((0,_.SU)(a)("market.task.edit.subject"))+":",1),(0,_._)("div",er,(0,_.zw)((0,_.SU)(j).subject||"--"),1)])]),(0,_._)("div",ei,[(0,_.SU)(G)?((0,_.wg)(),(0,_.j4)(e_,{key:0,value:(0,_.SU)(G)},null,8,["value"])):((0,_.wg)(),(0,_.iD)("div",eu,(0,_.zw)((0,_.SU)(a)("market.task.edit.preview.empty")),1))])]),_:1})])],4)]),(0,_._)("div",ed,[(0,_.Wm)(S,{type:"primary",onClick:eo},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("common.actions.confirm")),1)]),_:1}),(0,_.Wm)(S,{class:"ml-16px",secondary:"",onClick:M},{default:(0,_.w5)(()=>[(0,_.Uk)((0,_.zw)(e.$t("common.actions.back")),1)]),_:1})])])}}}),eo=(0,G.default)(en,[["__scopeId","data-v-df8dad9a"]])}}]);